---
title: "About"
---

```{r}
# Load the libraries
library(leaflet)
library(shiny)
library(quarto)

# Define the countries and features data
# Source: [World Bank](https://stackoverflow.com/questions/73154111/quarto-create-a-shiny-interactive-qmd-document-within-a-quarto-website)
countries <- read.csv("https://raw.githubusercontent.com/R-CoderDotCom/samples/main/countries.csv")
features <- read.csv("https://raw.githubusercontent.com/R-CoderDotCom/samples/main/features.csv")

# Create a shiny app with a leaflet map
app <- shinyApp(
  ui = fluidPage(
    titlePanel("Leaflet map with country and feature selection"),
    sidebarLayout(
      sidebarPanel(
        selectInput("country", "Select a country", choices = countries$Country),
        selectInput("feature", "Select a feature", choices = features$Feature)
      ),
      mainPanel(
        leafletOutput("map")
      )
    )
  ),
  server = function(input, output, session) {
    # Reactive expression to filter the data based on the inputs
    filtered_data <- reactive({
      dplyr::inner_join(countries, features, by = "Country") %>%
        dplyr::filter(Country == input$country, Feature == input$feature)
    })
    
    # Render the leaflet map
    output$map <- renderLeaflet({
      leaflet() %>%
        addTiles() %>%
        setView(lng = filtered_data()$Longitude, lat = filtered_data()$Latitude, zoom = 4) %>%
        addMarkers(lng = filtered_data()$Longitude, lat = filtered_data()$Latitude, popup = paste0(filtered_data()$Country, ": ", filtered_data()$Value))
    })
  }
)

# Create a quarto website page with the shiny app
quarto::quarto_serve(
  quarto::quarto_website(
    "index.qmd",
    content = paste0(
      "---\n",
      "title: \"Quarto website page with shiny app\"\n",
      "format: html\n",
      "---\n",
      "\n",
      "This is a quarto website page that embeds a shiny app showing a leaflet map.\n",
      "\n",
      "{r}\n",
      "quarto::quarto_shiny(app)\n",
      ""
    )
  )
)
```